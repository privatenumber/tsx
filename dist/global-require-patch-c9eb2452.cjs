"use strict";var c=require("module"),E=require("fs"),d=require("get-tsconfig"),p=require("./index-971a6964.cjs"),f=require("./source-map.cjs"),h=require("./client-fc143b89.cjs"),_=require("path"),x=require("./is-relative-path-pattern-d3bd85cb.cjs");const O=s=>{if(s.includes("import")||s.includes("export"))try{return p.parseEsm(s)[3]}catch{return!0}return!1},j=/\.[cm]?tsx?$/,u=process.env.TSX_TSCONFIG_PATH?{path:_.resolve(process.env.TSX_TSCONFIG_PATH),config:d.parseTsconfig(process.env.TSX_TSCONFIG_PATH)}:d.getTsconfig(),b=[".cts",".mts",".ts",".tsx",".jsx"],P=[".js",".cjs",".mjs"],S=u&&d.createFilesMatcher(u),v=Object.assign(Object.create(null),c._extensions),A=v[".js"],y=(s,e)=>{var t;(t=h.parent)!=null&&t.send&&h.parent.send({type:"dependency",path:e});const o=b.some(n=>e.endsWith(n)),a=P.some(n=>e.endsWith(n));if(!o&&!a)return A(s,e);let r=E.readFileSync(e,"utf8");if(e.endsWith(".cjs")){const n=p.transformDynamicImport(e,r);n&&(r=f.shouldApplySourceMap()?f.inlineSourceMap(n):n.code)}else if(o||O(r)){const n=p.transformSync(r,e,{tsconfigRaw:S==null?void 0:S(e)});r=f.shouldApplySourceMap()?f.inlineSourceMap(n):n.code}s._compile(r,e)};[".js",".ts",".tsx",".jsx"].forEach(s=>{v[s]=y}),Object.defineProperty(v,".mjs",{value:y,enumerable:!1});const R=`${_.sep}node_modules${_.sep}`,F=u&&d.createPathsMatcher(u),T=c._resolveFilename.bind(c),M=(s,e,t,o)=>{var a,r;const n=x.resolveTsPath(s);if(e!=null&&e.filename&&(j.test(e.filename)||(r=(a=u)==null?void 0:a.config.compilerOptions)!=null&&r.allowJs)&&n)for(const m of n)try{return T(m,e,t,o)}catch(i){const{code:l}=i;if(l!=="MODULE_NOT_FOUND"&&l!=="ERR_PACKAGE_PATH_NOT_EXPORTED")throw i}},g=(s,e,t,o)=>{var a;const r=s.indexOf("?");if(r!==-1&&(s=s.slice(0,r)),F&&!x.isRelativePathPattern.test(s)&&!((a=e==null?void 0:e.filename)!=null&&a.includes(R))){const m=F(s);for(const i of m){const l=M(i,e,t,o);if(l)return l;try{return T(i,e,t,o)}catch{}}}const n=M(s,e,t,o);return n||T(s,e,t,o)},N=()=>{const{sourceMapsEnabled:s}=process,{_extensions:e,_resolveFilename:t}=c;return process.setSourceMapsEnabled(!0),c._extensions=v,c._resolveFilename=g,()=>{s===!1&&process.setSourceMapsEnabled(!1),c._extensions=e,c._resolveFilename=t}};exports.register=N,exports.resolveFilename=g;
